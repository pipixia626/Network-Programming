# I/O模式

程序进行输入操作有两步
1. 等待有数据可以读
2. 将数据从系统内核中拷贝到程序的数据区
   
对于一个套接字的输入操作，第一步一般来说是等待数据从网络上传到本地，当数据从网络上传到本地，即数据包到达的时候，数据会从网络层拷贝到内核的缓存中，第二步是从内核中把数据拷贝到程序的数据区中

## 阻塞I/O
缺省的

对于一个UDP套接字来说，数据就绪的标志

1. 已经收到一整个数据报
2. 没有收到

TCP：需要添加一些其他的变量

## 非阻塞I/O
当我请求的I/O 操作不能够马上完成，你想让我的进程进行休眠等待的时候，不要这么做，请马上返
回一个错误给我。”

当一个应用程序使用了非阻塞模式的套接字，它需要使用一个循环来侦听是否一个文件描述符有数据可读(polling)，应用程序不停的polling内核来检查是否I/O操作已经就绪，这是一个很浪费CPU资源的操作


## I/O多路复用
调用select()函数和poll函数，在调用它们的时候阻塞

当调用select函数阻塞的时候，select函数等待数据报套接字进入读就绪状态，当select函数返回的时候，也就是套接字可以读取数据的时候，我们就可以调用recvform函数来将数据拷贝到我们程序缓冲区

相对于阻塞模式来说，多路复用能同时等待多个文件描述符，而这些文件描述符其中的任意一个进入读就绪状态，select函数就可以返回

### 常用情况
1. 当一个客户端需要同时处理多个文件描述符的输入输出操作的时候
2. 当程序需要同时进行多个套接字的操作的时候
3. 如果一个服务器程序同时使用TCP和UDP协议
4. 如果一个服务器同时使用多种服务并且每种服务可能使用不同的协议

## 信号驱动I/O模式
让内核在文件描述符就绪的时候使用SIGIO信号来通知我们

（1） 一个和 SIGIO 信号的处理函数必须设定。
（2） 套接字的拥有者必须被设定。一般来说是使用 fcntl 函数的 F_SETOWN 参数来
进行设定拥有者。
（3） 套接字必须被允许使用异步 I/O。一般是通过调用 fcntl 函数的 F_SETFL 命令，
O_ASYNC 为参数来实现。

## 异步I/O

当我们运行在异步 I/O 模式下时，我们如果想进行 I/O 操作，只需要告诉内核我们要
进行 I/O 操作，然后内核会马上返回。具体的 I/O 和数据的拷贝全部由内核来完成，我们
的程序可以继续向下执行。当内核完成所有的 I/O 操作和数据拷贝后，内核将通知我们的
程序。
异步 I/O 和 信号驱动 I/O 的区别是：
l 信号驱动 I/O 模式下，内核在操作可以被操作的时候通知给我们的应用程序发送
SIGIO 消息。
l 异步 I/O 模式下，内核在所有的操作都已经被内核操作结束之后才会通知我们的
应用程序。
